\documentclass[a4paper,10pt]{article}

\usepackage[latin2]{inputenc}
\usepackage[hungarian]{babel}
\usepackage{t1enc}
\usepackage{listings}
\usepackage{textcomp}

%opening
\title{Hello Window! - GTK+/gtkmm programozás GNU/Linux alatt}
\author{Pfeiffer Szilárd}
\date{2008. szeptember 10.}

\begin{document}

\maketitle

\begin{abstract}
A \textit{GTK+} (\textit{GIMP Toolkit}) egy \textit{C} nyelven --ám objektum-orientált meg\-kö\-ze\-lí\-tés\-sel-- íródott, grafikus felhasználói felületek (\textit{GUI}) létrehozására használatos al\-kal\-ma\-zás-programozási interfész. A \textit{gtkmm} nem más, mint ennek a függvénykönyvtának a \textit{C++} változata, pontosabban foglamazva \textit{wrapper}e. Mindkét terjesztése \textit{LGPL} licensz alatt történik, így bátran felhasználható mind szabad/ingyenes, mind kereskedelmi szoftevrek létrehozására.

A most kezdõdõ sorozat célja az abszólút kezdetektõl indulva bemutatni a \textit{GTK+} és a \textit{gtkmm} hasonlóságait, különbözõségeit, sajátosságait eljutva egy olyan szintre, ahol remélhetõleg a több éves tapasztalattal rendelkezõ fejlesztõk is találnak hasznos, megfontolásra érdemes ötleteket, információkat.
\end{abstract}

\newpage

\section{Bevezetés}

A cikksorozat ezen elsõ részében a \textit{GTK+}/\textit{gtkmm} programozás szempontjából teljesen az alapokról indulunk, de feltételezünk némi jártassságot a \textit{C}, illetve \textit{C++} nyelvû programozás, illetve a \textit{Linux} alatti fejlesztés terén. Utóbbiak tekintetében javasolt Vomberg István, Programozás Linux környezetben címû cikksorozatának tanulmányozása, hisz számos területet érintünk az ott tárgyaltak közül anélkül, hogy itt részletekbe menõ kifejtésük megtörténne.

\section{Összehasonlítás}

Mielõtt a kódolás technikai részleteire rátérnénk, tegyünk egy rövid kitérõt a tisztánlátás érdekében és hasonlítsuk össze a két felületprogramozási nyelv alapvetõ tulajdonságait:\vspace{16pt}

\begin{tabular}[t]{l c c}
                                       & \textit{GTK+}                     & \textit{gtkmm}   \\\\
\textbf{Felhasználási terület:}        & GUI fejlesztés                    & GUI fejlesztés   \\\\
\textbf{Implementáció nyelve:}         & C                                 & C++              \\\\
\textbf{Implementáció módja:}          & natív                             & wrapper          \\\\
\textbf{Objektumorinentált}            &                                   &                  \\
\textbf{technikák használata:}         & közvetett                         & natív            \\\\
\textbf{Típusellenõrzés:}              & futási idõben                     & fordításai dõben \\\\
\textbf{Licenc:}                       & LGPL                              & LGPL             \\\\
\textbf{Ismertebb projektek:}          & GNOME,                            & GNOME            \\
                                       & Evolution, Firefox, Gimp          &                  \\
\end{tabular}


\subsection{GTK+ vs. gtkmm}
Ahogy az a fentiekbõ is látszik a a \textit{C++} nyelvû változatnak megvannak a maga komoly elõnyei. Ezek közül talán a legfontosabb, hogy a nyelv nyújtotta módszereket, mint például az örököltetés, itt közvetlenül használhatjuk ki. Ez természetesen nem jelenti azt, hogy a \textit{GTK+} esetén erre ne lenne lehetõségünk, ugyanakkor meg kell jegyezni, hogy míg a \textit{gtkmm} esetén ez jétszi könnyedséggel megtehetõ, addig az eredeti változat alkalmazásával ez kissé körülményes. Egy másik megfontolandó érv a típusbiztosság, melynek elõnyeit nem lehet eléggé hangsúlyozni, hiszen hosszú órák hibakeresésétõl óvhat meg minket. A \textit{GTK+} a \textit{GObject} révén --melyre egy késõbbi részben részletesebben is foglalkozunk majd-- rendelkezik egy frappáns mechanizmussal, mely lehetõvé teszi a futásidejû típusellenõrzést a \textit{widget}ek esetén, de nem vetekedhet a \textit{C++} nyújtotta fordítási idejû hibaüzenetekkel.

Megfeledkezni azonban nem lehet a tényrõl, hogy a \textit{C++} fordító közel sem olyan gyakran áll rendelkezésre, mint azt gondolnánk. Számos olyan terület létezik ugyanis, melyek esetén alapvetõ megkötés a \textit{C} nyelv. Megemlítendõ továbbá, hogy a \textit{gtkmm} nem az egyetlen port, hiszen létezik többek között \textit{python} (\textit{pyGTK}), \textit{perl} (gtk2-perl), \textit{ruby}, \textit{java} nyelvû változat is.

\subsection{Kódszervezés}
Elöljáróban fontos lehet még tudni a nyelvet megvalósító implementáció szervezésérõl, hogy példaértéküen választja szét a funkcinalitás egyes elemeit több különálló, jól elhatárolt részegységre, melyek ugyan támaszkodnak egymásra, de a megoldás nagyban elõsegíti a rugalmasságot és a portabilitást. A \textit{GDK} (\textit{GIMP Drawing Kit}) felelõs a rajzolási primitívek megvalóításáér, tulajdonképpen nem egyéb, mint egy wrapper az ablakozó rendszer köré. Hasznossága abban áll, hogy amennyiben sikerül portolni azt egy új grafikus környezetre, akkor a \textit{GTK+} máris mûködõképessé válhat. A \textit{GObject}, mely a \textit{GLib} része minden widget ``õsosztálya'', ugyanakkor saját eszközök alapkövévé is thetjük, hisz egyebek mellett lehetõvé tesz referenciaszálálást, futásidejû típusellenõrzést, tulajdonságok hozzárendelését és azok értékének futásidõben történõ változtatását.

\subsection{GLib}
A GLib maga egy önálló függvénykönyvtár, mely számos hasznos --a \textit{C} nyelv elemeként nem létezõ-- programozói segldeszközt tartalmaz. Ezek közül a leggyakrabban hasznátak az alábbiak:

\begin{description}
 \item[Alkalmazásfejlsztési támogatás] szálak, aszinkron kommunikáció a szálak között, dinamikus modulbetöltés, memória-, pipe-, socket-, fájlkezelés, többszintû logolás
 \item[Fejlesztõi segédeszközök] sztring-, dátum-, idõkezelés, karakterkonverziós eszközök, parancssori paraméterek, XML, .ini, bookmar fájlok feldolgozása, idõzítõk, reguláris kifejezések
 \item[Adattípusok] láncolt listák, fák, asszociatív tömbök, szekvenciák, sorok, dinamikusan méretezhetõ tömbök
\end{description}

Itt is létezik \textit{C++} nyelvû változat, ahogy a \textit{GTK+} esetén is, ám itt a wrapper csak akkor készül el, ha a C++ standard könyvtára nem tartalmaz azonos funkcionalitású eszközt.

\section{Elsõ ablakunk}

Ennyi bevezetés után épp ideje már némi kódot látnunk és azt górcsõ alá vennünk némiképp. Rögvest célszerû hozzátenni, hogy az alabbi --amúgy a gyakorlatban nem túl komoly hasznosságú-- példa teljes részletességel történõ kommentálása önmagában is egy cikksorozat témája lehetne. Szoritkozzunk most ennek okán csak a lényegre:

\subsection{A kód}

\vspace{16pt}
\fontsize{8pt}{8pt}
\begin{verbatim}
#include <gtkmm.h>                               #include <gtk/gtk.h>

int main(int argc, char *argv[])                 int main(int argc, char *argv[])
{                                                {
  GtkWidget *window;

  gtk_init (&argc, &argv);                         Gtk::Main kit(argc, argv);

  window = gtk_window_new (GTK_WINDOW_TOPLEVEL);   Gtk::Window window;
  gtk_widget_show  (window);

  gtk_main ();                                     Gtk::Main::run(window);

  return 0;                                        return 0;
}                                                }
\end{verbatim} 

A fenti példaprogramok forrásfájljai és azok \textit{GTK+}/\textit{gtkmm} weblapjáról, az alábbi linkeken:

\begin{verbatim}
http://www.flosszine.org/
http://library.gnome.org/devel/gtk-tutorial/stable/c39.html
http://www.gtkmm.org/docs/gtkmm-2.4/docs/tutorial/html/chapter-basics.html
\end{verbatim}

\subsection{Némi magyarázat}

A lefordított programok természetesen ugyanazt az eredményt adják, de errõl egy picikét késõbb. Vegyük most szemügyre közelebbrõl a forráskódot amit a nagyfokó hasonlóság ellenére mutat eltéréseket is.

\subsubsection{Projektek különbözõségébõl adódó eltérések}

A legtöbb nyílt forrású projekt esetén igaz, hogy a kódolás és kódszervezés során egy meghatározott konvenciót követnek, ám amint ez a korábbi példából is látszik, egy olyan méretû projekt esetén, mint a \textit{GNOME} az egyes részterületeken lehetnek eltérések.

\begin{description}
 \item[Forráskód formázása] A \textit{GTK+} fejlesztõi a \textit{GNU coding standard} irányelveit alkalmazzák, míg a \textit{gktmmm} ettõl minimális mértékben eltérõ változat az alkalmaz.

 \item[Fejécfájlok helye] Mint az késõbbiekben megfigyelhetõ lesz a \textit{GTK+} \textit{header}ek esetén a fájloknak van egy \textit{gtk} prefixe, ugynakkor a \textit{gtkmm}-nél eznem használatos. Ez egyébiránt illeszkedig a nevezéktannál tapsztaltakkal.
 \end{description}

\subsubsection{Programozási nyelv okozta sajátosságok}

\begin{description}
 \item[Nevezéktan] A \textit{GTK+} minden saját makrót/függvényt \texttt{GTK}/\texttt{gtk} prefixszel lát el (\textit{GLib} esetén ez pusztán csak egy kis/nagy \texttt{g} betû), sõt egy adott részterület --például egy \textit{widget}-- saját ``névterülettel'' is rendelkezhet, azaz újabb prefixet vezethet be. Ezeket egymástól, illetve a ``valódi'' funkciót jelölõ nevektõl \texttt{\_} (aláhuzás) jellel választják el. A C++ wrapper kódát olvasva láthatjuk, hogy kihasználva a kézenfekvõ nyelvi lehetõséget, a prefixek szerepét a névterek veszik át, annyi különbséggel, hogy ezek neveiben csak az elsõ betû nagy.
 \item[Nyelvhez kötõdõ módszerek] A minapéldában megfigyelhetõ (az azonos funkciójú sorok párbaállítása révén), hogy a \textit{C++} kód némileg egyszerûbb, hiszen az ablakunk létrehozásakor nem kell a window típusára (\textit{toplevel}) vonatkozó paramétert megadnunk, azonos helyen lehet a változó deklarációja és elsõ felhasználása. Külön is említésre méltó, bár a \textit{C++} prgramozók számára nem meglepõ, hogy a main függvénybõl való kilépéskor a \textit{gtkmm} változat windowja felszabadul, míg a \textit{GTK+} verzió esetén ez csak azért történik meg, mert magából a programból is kiléptünk egyúttal.
\end{description}

\subsection{Vágyaink ablaka}

\subsubsection{Fordítás és linkelés}

Az alábbi parancssorok segítségével fordíthatóak elkészült programjaink:

\fontsize{8pt}{8pt}
\ \\
\texttt{gcc gtk\_window.c -o gtk\_window \`{}pkg-config {-}-cflags {-}-libs gtk+-2.0}
\ \\
\texttt{g++ gtkmm\_window.cc -o gtkmm\_window \`{}pkg-config gtkmm-2.4 {-}-cflags {-}-libs\`{}}
\\

Segítségünkre a \texttt{pkg-config} parancs van, hogy a \textit{gcc}-nek a megfelelõ paramétereket meg tudjuk adni. A \texttt{--cflags} paraméter hatására a fordításhoz, míg a \texttt{--libs} eredményeképp a linkeléshez szükséges opciókat kapjuk vissza. A parancs két \texttt{\`} (backtick) közé zárt. aminek hatsára annak kimenete része lesz a fordító parancssorának, amivel pont az áhytott hatást érjük el.

\subsubsection{Futtatás}

Ezel után már csak az örömteli pillanat van hátra, mikor is két különbözõ nyelven és függvénykönyvtárral lekódolt teljesen azonos funkciójú programunkat lefuttatjuk a \texttt{./gtk\_window}, illetve a \texttt{./gtkmm\_window} paranccsal.

\subsubsection{Eredmény}

\textit{Voil\`{a}!} Túlvagyunk két ablak --vagyis egy Windows-- lekódolásán. Ami eddi is közismert volt, újabb bizonyságot nyert, a Windows kódja lehet, hogy elegáns és egyszerû. ám az eredmény mégis hasznavehetetlen. Az utóbbin fogunk segíteni a következõ részekben.

\end{document}
